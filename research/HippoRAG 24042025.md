

## CÃ¡ch thá»©c táº¡o KG

- [HippoRAG/src/hipporag/utils/misc_utils.py at main Â· OSU-NLP-Group/HippoRAG](https://github.com/OSU-NLP-Group/HippoRAG/blob/main/src/hipporag/utils/misc_utils.py)
**Analyzing**

Pulling in details to give the best answer

Thought for 16 seconds

Trong HippoRAG (vÃ  HippoRAG 2), viá»‡c dá»±ng Knowledge Graph (KG) diá»…n ra trong module lÆ°u trá»¯ embeddings, cá»¥ thá»ƒ lÃ  file `src/hipporag/embedding_store.py`. QuÃ¡ trÃ¬nh nÃ y tÃ³m táº¯t nhÆ° sau:

1. **Thu tháº­p triples**
    
    - Tá»« káº¿t quáº£ OpenIE (`TripleRawOutput`) cá»§a tá»«ng passage, hÃ m `flatten_facts` gom toÃ n bá»™ triples duy nháº¥t láº¡i thÃ nh má»™t danh sÃ¡ch cÃ¡c tuple (subject, relation, object). .
        
2. **XÃ¡c Ä‘á»‹nh nodes**
    
    - DÃ¹ng hÃ m `extract_entity_nodes` Ä‘á»ƒ láº¥y ra toÃ n bá»™ cÃ¡c entity (subject vÃ  object) xuáº¥t hiá»‡n trong cÃ¡c triple, rá»“i duyá»‡t thÃ nh táº­p `phrase nodes`. .
        
    - NgoÃ i ra, má»—i passage cÃ²n Ä‘Æ°á»£c coi lÃ  má»™t `passage node` Ä‘á»ƒ giá»¯ context.
        
3. **XÃ¢y dá»±ng Ä‘á»“ thá»‹ (KG)**
    
    - Táº¡o igraph Graph tá»« list triples báº±ng `Graph.TupleList(graph_triples, directed=False)`.
        
    - ThÃªm thÃªm cÃ¡c cáº¡nh â€œsynonym edgeâ€ ná»‘i nhá»¯ng phrase nodes cÃ³ embedding cosine-similarity cao, vÃ  cÃ¡c cáº¡nh â€œcontext edgeâ€ ná»‘i phrase node vá»›i passage node chá»©a nÃ³.
        
4. **LÆ°u láº¡i KG**
    
    - Äá»“ thá»‹ nÃ y Ä‘Æ°á»£c giá»¯ trong `EmbeddingStore.graph` Ä‘á»ƒ dÃ¹ng cho bÆ°á»›c Personalized PageRank (PPR) khi truy váº¥n.
        

TÃ³m láº¡i, pháº§n â€œtáº¡o KGâ€ náº±m ngay trong `embedding_store.py`, trong phÆ°Æ¡ng thá»©c khá»Ÿi táº¡o/indexing, vá»›i ba bÆ°á»›c: chuyá»ƒn OpenIEâ†’flatten triples, extract entities thÃ nh nodes, rá»“i gá»i igraph Ä‘á»ƒ váº½ cáº¡nh tá»« triples vÃ  thÃªm cÃ¡c cáº¡nh phá»¥ trá»£ (synonym & context). Báº¡n cÃ³ thá»ƒ má»Ÿ file nÃ y Ä‘á»ƒ xem chi tiáº¿t gá»i `igraph.Graph.TupleList` vÃ  pháº§n thÃªm cáº¡nh.


# 2. CÃ¡ch thá»©c PPR hoáº¡t Ä‘á»™ng

**Designing a simple mini dataset**

I think the goal here is to create a simple example for PPR that shows how passages and triples work, while keeping it down to earth. I could go with something like: "What county is Erik Hort's birthplace in?" or "What sport does Serena Williams' spouse play?" Hm, simpler would be something like "What country is the capital of Rome in?" but that's just one hop. I want multi-hop - maybe "Which city hosts the university where Albert Einstein studied?"

Trying to simplify that!

Thought for 10 seconds

## VÃ­ dá»¥ â€œtÃ­ honâ€â€ƒâ€“â€ƒtá»« Erik Hort â†’ Rockland County

**CÃ¢u há»i ngÆ°á»i dÃ¹ng:**

> _â€œQuáº­n (county) cá»§a nÆ¡i sinh Erik Hort lÃ  quáº­n nÃ o?â€_

NÆ°á»›c nÃ o lÃ  nÆ¡i CÆ°á»ng sinh ra? 

- CÆ°á»ng sinh ra á»Ÿ TB 
- TB lÃ  1 pháº§n cá»§a VN 

=> Top k Node Phrase => node CÆ°á»ng - sinh ra á»Ÿ TB  (seed = similarty) vÃ  Ä‘oáº¡n 1 (seed = s * w) (w=0.05) 
- Qua má»—i bÆ°á»›c lan truyá»n - lan truyá»n má»±c. => 50% lÆ°á»£ng má»±c sáº½ á»Ÿ láº¡i node cÅ© vÃ  50% lÆ°á»£ng má»±c cÃ²n láº¡i sáº½ á»Ÿ cÃ¡c node khÃ¡c liá»n ká»   -> lan truyá»n seed Ä‘Æ°á»£c Ä‘áº¿n passage 2. 
- Cuá»‘i cÃ¹ng nÃ³ sáº½ SO SÃNH cÃ¡c passage Ä‘á»ƒ mÃ  tÃ¬m ra top k passage liÃªn quan nháº¥t (cÃ³ seed lá»›n nháº¥t). Ä‘Æ°a vÃ o context 
### â¶ Khung dá»¯ liá»‡u siÃªu nhá»

| ID     | Äoáº¡n vÄƒn (passage)                                   | Triple OpenIE trÃ­ch Ä‘Æ°á»£c                   |
| ------ | ---------------------------------------------------- | ------------------------------------------ |
| **P1** | â€œ**Erik Hort** was **born in** **Montebello**.â€      | (Erik Hort, **born_in**, Montebello)       |
| **P2** | â€œ**Montebello** is **part of** **Rockland County**.â€ | (Montebello, **part_of**, Rockland County) |

Tá»« hai triple nÃ y, HippoRAG láº­p **Ä‘á»“ thá»‹**:

```
Erik_Hort â”€â”€born_inâ”€â”€â–º Montebello â”€â”€part_ofâ”€â”€â–º Rockland_County
   â–²                              â–²
   â”‚ contains                     â”‚ contains
   â”‚                              â”‚ 
  P1                              P2      (hai node passage)
```

### â· Háº¡t giá»‘ng (seed) khi truy váº¥n

- **Phrase-seed:** â€œErik Hortâ€ (tá»« triple lá»c bá»Ÿi LLM).
    
- **Passage-seed:** P1 (Ä‘oáº¡n vÄƒn khá»›p truy váº¥n vá» â€œErik Hortâ€) â€“ Ä‘iá»ƒm cosine vá»›i cÃ¢u há»i cao.
    

### â¸ Cháº¡y Personalized PageRank (Î± = 0.5)

|VÃ²ng lan|Xuáº¥t phÃ¡t|Flow xÃ¡c suáº¥t (mÅ©i tÃªn)|Ai â€œÄ‘Æ°á»£c bÆ¡mâ€ thÃªm?|
|---|---|---|---|
|BÆ°á»›c 0|Seed only|â€“|Erik Hort, P1|
|BÆ°á»›c 1|Erik Hort|born_in â†’ Montebello ; reset vá» seed|**Montebello**|
|BÆ°á»›c 2|Montebello|part_of â†’ Rockland County ; contains â†’ P2|**Rockland County**, **P2**|
|BÆ°á»›c 3+|Tiáº¿p tá»¥c|reset + lan qua láº¡i|P2 nháº­n thÃªm xÃ¡c suáº¥t|

_Sau ~30 vÃ²ng láº·p (Ä‘á»“ thá»‹ cá»±c nhá» nÃªn há»™i tá»¥ ráº¥t nhanh)._

### â¹ TÃ­nh Ä‘iá»ƒm passage

Score(Pk)=âˆ‘vâˆˆPkÏ€v\text{Score}(P_k)=\sum_{v\in P_k} \pi_v

- P1 váº«n cÃ³ Ä‘iá»ƒm khÃ¡ cao (seed).
    
- **P2 vá»t lÃªn top-1** nhá» Montebello â†’ P2 cáº¡nh _contains_ + dÃ²ng cháº£y tá»« seed.
    

### âº Káº¿t quáº£

|Thá»© háº¡ng sau PPR|Äoáº¡n vÄƒn|VÃ¬ sao lÃªn háº¡ng?|
|---|---|---|
|**1**|**P2**: â€œâ€¦Montebello is part of Rockland County.â€|Nháº­n xÃ¡c suáº¥t â€œÄ‘a bÆ°á»›câ€ (Erik Hort â†’ Montebello â†’ P2)|
|2|P1|Seed gá»‘c, nhÆ°ng Ã­t liÃªn quan trá»±c tiáº¿p tá»›i â€œcountyâ€|

LLM-reader Ä‘á»c P2, trÃ­ch ngay: **â€œRockland County.â€**

---

### _Táº¡i sao cáº§n PPR?_

Náº¿u chá»‰ dÃ¹ng embedding:

_Query_ â€œcounty of Erik Hortâ€™s birthplaceâ€ gáº§n nghÄ©a vá»›i â€œErik Hortâ€, **khÃ´ng** giá»‘ng P2 â‡’ P2 khÃ³ lá»t top-k.

Nhá» PPR, passage P2 **Ä‘Æ°á»£c â€œkÃ©oâ€ lÃªn** dÃ¹ _khÃ´ng_ giá»‘ng trá»±c tiáº¿p truy váº¥n, vÃ¬ Ä‘á»“ thá»‹ Ä‘Ã£ chá»©ng minh liÃªn káº¿t Ä‘a bÆ°á»›c giá»¯a Erik Hort vÃ  Rockland County. ÄÃ¢y chÃ­nh lÃ  _multi-hop reasoning trong má»™t lÆ°á»£t_.


Thought for a couple of seconds

### Thá»­ tÆ°á»Ÿng tÆ°á»£ng tháº¿ nÃ y nhÃ© â€“ chá»‰ 5 nÃºt, váº½ ra giáº¥y lÃ  tháº¥y ngay

|ID|Loáº¡i nÃºt|NhÃ£n|Giáº£i thÃ­ch|
|---|---|---|---|
|A|Phrase|â€œErik Hortâ€|ngÆ°á»i Ä‘Æ°á»£c há»i|
|B|Phrase|â€œMontebelloâ€|nÆ¡i sinh cá»§a Erik|
|C|Phrase|â€œRockland Countyâ€|quáº­n chá»©a Montebello|
|P1|Passage|â€œP1â€|Ä‘oáº¡n vÄƒn nÃ³i _Erik Hort sinh á»Ÿ Montebello_|
|P2|Passage|â€œP2â€|Ä‘oáº¡n vÄƒn nÃ³i _Montebello thuá»™c Rockland County_|

**Cáº¡nh (mÅ©i tÃªn)**

- A â†’ B â€ƒ(born_in)
    
- B â†’ C â€ƒ(part_of)
    
- A,B â†’ P1â€ƒ(contains)
    
- B,C â†’ P2â€ƒ(contains)
    

---

## 1. Giai Ä‘oáº¡n â€œcháº¥m má»±câ€ (khá»Ÿi táº¡o seed)

- CÃ¢u há»i: **â€œQuáº­n nÃ o chá»©a nÆ¡i sinh cá»§a Erik Hort?â€**
    
- Ta â€œcháº¥mâ€ 50 % má»±c lÃªn **A** (Erik Hort) vÃ¬ nÃ³ khá»›p cÃ¢u há»i.
    
- 50 % cÃ²n láº¡i ta ráº£i Ä‘á»u lÃªn cÃ¡c **passage cosine cao** (á»Ÿ vÃ­ dá»¥ nhá» nÃ y P1 â‰ˆ 10 %).
    

> DÃ²ng má»±c nÃ y chÃ­nh lÃ  **vector reset s** trong PPR.

---

## 2. â€œMá»±c loangâ€ (1 vÃ²ng lan truyá»n)

- **Giáº£ sá»­** má»—i nÃºt chia má»±c cá»§a mÃ¬nh cho **táº¥t cáº£ cáº¡nh Ä‘i ra**.
    
- **A (50 %)** â†’ Ä‘á»• háº¿t sang **B** (1 cáº¡nh) â‡’ B nháº­n 50 %.
    
- **P1 (10 %)** khÃ´ng cÃ³ cáº¡nh Ä‘i ra â†’ má»±c á»Ÿ láº¡i.
    

Káº¿t thÃºc vÃ²ng 1:

```
A: 0â€ƒ B: 0.50â€ƒ C: 0â€ƒ P1: 0.10â€ƒ P2: 0
```

---

## 3. â€œQuay vá» cháº¥mâ€ (teleport)

Quy Ä‘á»‹nh **Î± = 0.5**

- NghÄ©a lÃ  **má»—i vÃ²ng**, ta **láº¥y 50 %** lÆ°á»£ng má»±c cá»§a má»i nÃºt **lau sáº¡ch** rá»“i **Ä‘á»• láº¡i Ä‘Ãºng vá»‹ trÃ­ seed ban Ä‘áº§u**.
    
- 50 % cÃ²n láº¡i giá»¯ nguyÃªn (tiáº¿p tá»¥c loang á»Ÿ vÃ²ng sau).
    

Ãp dá»¥ng:

```
 Giá»¯ láº¡i 0.5 Ã— (A=0,B=0.50,C=0,P1=0.10,P2=0)
 => A:0   B:0.25 C:0  P1:0.05 P2:0

 Äá»• 0.5 tá»•ng má»±c (0.5) trá»Ÿ láº¡i seed:
    A +0.25     P1 +0.05   (vÃ¬ seed A=0.5, P1=0.1 ban Ä‘áº§u)
Káº¿t thÃºc vÃ²ng 1:  A:0.25 B:0.25 C:0 P1:0.10 P2:0
```

---

## 4. VÃ²ng 2 (loang tiáº¿p)

1. **Loang**
    
    - A (0.25) â†’ Bâ€ƒ(+0.25)
        
    - B (0.25) â†’ Câ€ƒ(+0.25) **vÃ ** P2 (+0.25) (2 cáº¡nh)
        
    - P1 (0.10) giá»¯
        
2. **Teleport 50 %**
    
    - Giá»¯ láº¡i: A0 B0.25â†’0.125 â€¦
        
    - Cháº¥m láº¡i seed (0.25 A + 0.05 P1)
        

Káº¿t quáº£ gáº§n Ä‘Ãºng sau vÃ²ng 2:

```
A â‰ˆ 0.25   B â‰ˆ 0.13   C â‰ˆ 0.13   P1 â‰ˆ 0.10   P2 â‰ˆ 0.13
```

---

## 5. Cá»© tháº¿ 4-5 vÃ²ng nho nhá» má»±c sáº½ **á»•n Ä‘á»‹nh**

- **Passage P2** (nÃ³i Rockland County) **dáº§n nháº­n nhiá»u má»±c** vÃ¬ nÃ³ há»©ng tá»« **B** vÃ  **C** qua cáº¡nh _contains_.
    
- **Rank cuá»‘i**: P2 â‰¥ P1 dÃ¹ cÃ¢u há»i **khÃ´ng chá»©a chá»¯ â€œRockland Countyâ€**.
    

> **ÄÃ³ chÃ­nh lÃ  â€œmulti-hop reasoning má»™t lÆ°á»£tâ€**:  
> A (Erik) â†’ B (Montebello) â†’ C (County) â†’ P2 (Ä‘oáº¡n vÄƒn Ä‘Ã­ch).

---

## TÃ³m táº¯t 1 cÃ¢u

> **PPR = cho má»±c loang trÃªn Ä‘á»“ thá»‹ nhÆ°ng cá»© ná»­a thÃ¬ hÃºt vá» seed, nhá» váº­y má»±c len lá»i qua 2-3 cáº¡nh rá»“i cháº£y tá»›i passage xa, giÃºp RAG láº¥y luÃ´n tÃ i liá»‡u multi-hop mÃ  khÃ´ng cáº§n gá»i LLM nhiá»u láº§n.**

(Hiá»ƒu chÆ°a? Náº¿u cÃ²n vÆ°á»›ng Ä‘oáº¡n nÃ o cá»© há»i tiáº¿p nhÃ©!)


Thought for 14 seconds

### 1. Khá»Ÿi táº¡o â€œseedâ€ vÃ  chia trá»ng sá»‘ ban Ä‘áº§u

|Loáº¡i node|CÃ¡ch chá»n lÃ m seed|Trá»ng sá»‘/reset-probability ban Ä‘áº§u _s_|
|---|---|---|
|**Phrase nodes** (cÃ¡c cá»¥m danh tá»«/Ä‘á»‘i tÆ°á»£ng trong triple Ä‘Ã£ Ä‘Æ°á»£c lá»c)|â€“ Láº¥y tá»‘i Ä‘a _k = 5_ phrase cÃ³ Ä‘iá»ƒm COSINE cao nháº¥t so vá»›i truy váº¥n.â€“ Äiá»ƒm cá»§a **má»—i phrase** = **trung bÃ¬nh** Ä‘iá»ƒm xáº¿p háº¡ng cá»§a táº¥t cáº£ triple mÃ  nÃ³ xuáº¥t hiá»‡n. îˆ€citeîˆ‚turn6file13îˆ|DÃ¹ng tháº³ng Ä‘iá»ƒm xáº¿p háº¡ng Ä‘Ã³ lÃ m pháº§n tá»­ tÆ°Æ¡ng á»©ng trong vector _s_.|
|**Passage nodes** (toÃ n bá»™ Ä‘oáº¡n vÄƒn gá»‘c)|KhÃ´ng lá»c â€“ **táº¥t cáº£** passage Ä‘á»u trá»Ÿ thÃ nh seed â†’ giÃºp PPR â€œkhÃ¡m phÃ¡â€ xa. îˆ€citeîˆ‚turn6file13îˆ|Äiá»ƒm COSINE giá»¯a passage & truy váº¥n **Ã— há»‡ sá»‘ w**. Há»‡ sá»‘ nÃ y (máº·c Ä‘á»‹nh **w = 0.05**) Ä‘áº£m báº£o phrase-nodes váº«n chiáº¿m Æ°u tháº¿, cÃ²n passage-nodes chá»‰ nháº­n â€œmá»±c loÃ£ngâ€. Thá»­ nghiá»‡m Ä‘iá»u chá»‰nh _w_ Ä‘Æ°á»£c liá»‡t kÃª á»Ÿ Báº£ng 5. îˆ€citeîˆ‚turn6file8îˆ|

> ğŸ’¡ HÃ¬nh áº£nh â€œcháº¥m má»±câ€: **Ä‘á»• nhiá»u má»±c (50 Â± %) vÃ o phrase-node quan trá»ng, ráº¯c Ã­t má»±c (â‰ˆ 5 %) loang trÃªn cÃ¡c passage** chÃ­nh lÃ  phÃ©p áº©n dá»¥ cho báº£ng trÃªn.

---

### 2. Lan truyá»n & cáº­p nháº­t trá»ng sá»‘ sau má»—i bÆ°á»›c

HippoRAG 2 cháº¡y **Personalized PageRank** trÃªn Ä‘á»“ thá»‹ káº¿t há»£p (phrase + passage):

nt+1â€…â€Š=â€…â€Š(1âˆ’d)â€…â€Šsâ€…â€Š+â€…â€Šdâ€…â€ŠAâŠ¤nt\mathbf{n}_{t+1}\;=\;(1-d)\;\mathbf{s}\;+\;d\;A^{\top}\mathbf{n}_{t}

- **A**: ma tráº­n chuyá»ƒn tiáº¿p chuáº©n hoÃ¡ (tá»« phrase â†’ phrase, phrase â†’ passage, passage â†’ phrase).
    
- **d**: há»‡ sá»‘ â€œtiáº¿p tá»¥c bÆ°á»›câ€ (_damping_, máº·c Ä‘á»‹nh 0.5).
    
- s\mathbf{s}: vector reset vá»«a mÃ´ táº£ á»Ÿ má»¥c 1.
    

á» má»—i vÃ²ng láº·p:

1. **99 Ã— %** xÃ¡c suáº¥t bá»‹ â€œÄ‘áº©yâ€ theo cÃ¡c cáº¡nh A (lan truyá»n qua quan há»‡ â€œsynonymâ€, â€œcontainsâ€, â€œtriple-edgeâ€ â€¦).
    
2. **1 - d** pháº§n xÃ¡c suáº¥t â€œbá»‘c hÆ¡iâ€ trá»Ÿ vá» seed theo Ä‘Ãºng tá»· lá»‡ **s** â†’ giá»¯ cho phrase-node trá»ng yáº¿u luÃ´n Ä‘Æ°á»£c â€œtiáº¿p mÃ¡uâ€, Ä‘á»“ng thá»i passage-node váº«n cÃ³ chÃºt â€œmá»±câ€ duy trÃ¬.
    

Thuáº­t toÃ¡n láº·p tá»›i há»™i tá»¥ (â‰¤ 50 vÃ²ng), thu Ä‘Æ°á»£c vector phÃ¢n bá»‘ cuá»‘i nâˆ—\mathbf{n}^{*}.

---

### 3. TÃ­nh Ä‘iá»ƒm cuá»‘i & truy há»“i

- **Äiá»ƒm node** = pháº§n tá»­ tÆ°Æ¡ng á»©ng trong nâˆ—\mathbf{n}^{*}.
    
- **Äiá»ƒm passage** = tá»•ng nâˆ—\mathbf{n}^{*} cá»§a **node passage** Ä‘Ã³ **+** cá»§a má»i phrase náº±m bÃªn trong (edge _contains_).
    
- Sáº¯p xáº¿p Ä‘iá»ƒm passage â†’ láº¥y top-k (k = 5) náº¡p vÃ o reader LLM.
    

Nhá» cÃ¡ch **gieo â€œmá»±câ€ phÃ¢n táº§ng** (phrase chiáº¿m pháº§n lá»›n, passage ráº£i má»ng) + **lan truyá»n PPR hai lá»›p**, HippoRAG 2:

- Giá»¯ Ä‘Æ°á»£c **chá»‰ dáº«n máº¡nh** cá»§a khÃ¡i niá»‡m trong truy váº¥n.
    
- Váº«n â€œngá»­iâ€ Ä‘Æ°á»£c cÃ¡c passage xa qua nhá»¯ng Ä‘Æ°á»ng liÃªn káº¿t multi-hop.
    

> _â€œReset probabilities are assigned based on ranking scores for phrase nodes, while passage nodes receive scores proportional to their embedding similarity, **adjusted by a weight factor (Â§ 6.2)** to balance the influence between phrase nodes and passage nodes.â€_ îˆ€citeîˆ‚turn6file13îˆ

Äiá»u nÃ y lÃ½ giáº£i vÃ¬ sao ngay cáº£ vá»›i truy váº¥n Ä‘Ã²i há»i nhiá»u bÆ°á»›c suy luáº­n, HippoRAG 2 váº«n Ä‘áº¡t **Recall@5 = 74.7 % trÃªn MuSiQue vÃ  90.4 % trÃªn 2Wiki** â€“ cao hÆ¡n háº³n dense retriever tá»‘t nháº¥t. îˆ€citeîˆ‚turn6file9îˆ


```
theo tÃ´i hiá»ƒu

- Ban Ä‘áº§u láº¥y top k phrase, (tiáº¿n hÃ nh LLMs lá»c phrase nhiá»…u). Sau Ä‘Ã³ khá»Ÿi táº¡o seed ban Ä‘áº§u cho top K Ä‘á»u báº±ng chÃ­nh Ä‘iá»ƒm similary cá»§a node

- VÃ  láº¥y top k Passage, Ä‘iá»ƒm seed ban Ä‘áº§u = Äiá»ƒm COSINE giá»¯a passage & truy váº¥n Ã— há»‡ sá»‘ w. Há»‡ sá»‘ nÃ y (máº·c Ä‘á»‹nh w = 0.05) Ä‘áº£m báº£o phrase-nodes váº«n chiáº¿m Æ°u tháº¿, cÃ²n passage-nodes chá»‰ nháº­n â€œmá»±c loÃ£ngâ€

===

á» má»—i step. Lan truyá»n Ä‘Æ°á»£c tÃ­nh theo tá»· lá»‡ nhÆ° nÃ o ?
```


**Explaining Personalized PageRank**

To describe propagation, we need a Personalized PageRank equation: n_{t+1} = (1-d)_s + d_P^T n_t. Here, 'd' is the damping factor (usually 0.5). It governs how the probability splits between continuing on edges or teleporting. The transition matrix depends on edge types, such as phraseâ†’phrase or passageâ†’phrase. Normalization is key, and using bi-directional undirected edges is standard. In HippoRAG, specificity affects node weights. At each step, mass distributes based on edge weights, with a 50% chance to continue walking or teleport based on s.

Thought for 8 seconds

### CÃ¡ch â€œdÃ²ng má»±câ€ lan truyá»n á»Ÿ **má»—i bÆ°á»›c** (Personalized PageRank Â­â€“ PPR)

Giáº£ sá»­

- VV lÃ  táº­p node (phrase + passage)
    
- AâˆˆRâˆ£Vâˆ£Ã—âˆ£Vâˆ£A\in\mathbb R^{|V|\times |V|} lÃ  ma tráº­n ká» Ä‘Ã£ **chuáº©n-hoÃ¡ theo hÃ ng**
    
    - Má»—i cáº¡nh (u â†’ v) cÃ³ trá»ng sá»‘ 1/degâ¡+(u)1/\deg^+(u) (náº¿u khÃ´ng gÃ¡n trá»ng sá»‘ khÃ¡c).
        
- sâˆˆRâˆ£Vâˆ£\mathbf s\in\mathbb R^{|V|} lÃ  **vector seed** báº¡n vá»«a mÃ´ táº£  
    (âˆ‘jsj=1\sum_j s_j = 1; phrase-node chiáº¿m Ä‘a sá»‘, passage-node Ã— w = 0.05).
    
- dd lÃ  **damping factor** â€“ xÃ¡c suáº¥t â€œtiáº¿p tá»¥c bÆ°á»›câ€ (bÃ i bÃ¡o Ä‘áº·t d=0.5d=0.5 sau tuning). îˆ€citeîˆ‚turn6file13îˆ
    

---

#### CÃ´ng thá»©c lan truyá»n

â€…â€Šnt+1â€…â€Š=â€…â€Š(1âˆ’d)â€‰sâ€…â€Š+â€…â€Šdâ€‰Aâ€‰â£âŠ¤ntâ€…â€Š\boxed{\;\mathbf n_{t+1}\;=\;(1-d)\,\mathbf{s}\;+\;d\,A^{\!\top}\mathbf n_t\;}

- **NhÃ¡nh 1 â€“ â€œteleportâ€**
    
    - 1âˆ’d=0.51-d = 0.5 â‰ˆ 50 % khá»‘i â€œmá»±câ€ **quay tháº³ng vá» seed** theo Ä‘Ãºng tá»‰ lá»‡ s\mathbf s
        
    - â†’ báº£o Ä‘áº£m cÃ¡c phrase quan trá»ng luÃ´n Ä‘Æ°á»£c â€œtiáº¿p mÃ¡uâ€.
        
- **NhÃ¡nh 2 â€“ â€œwalkâ€**
    
    - d=0.5d = 0.5 â‰ˆ 50 % cÃ²n láº¡i **cháº£y dá»c cáº¡nh Ä‘á»“ thá»‹**
        
        - phrase âŸ· phraseâ€ƒ(synonym-edge, triple-edge)
            
        - phrase â†’ passageâ€ƒ(edge _contains_)
            
        - passage â†’ phraseâ€ƒ(ngÆ°á»£c _contains_)
            
    - TrÃªn má»—i node uu khá»‘i lÆ°á»£ng phÃ¢n bá»‘ Ä‘á»u cho cÃ¡c Ä‘á»‰nh ká» vv:
        
        Auv=1degâ¡+(u) A_{uv}=\frac{1}{\deg^+(u)}
- Láº·p cho tá»›i khi âˆ¥nt+1âˆ’ntâˆ¥1<10âˆ’6\|\mathbf n_{t+1}-\mathbf n_t\|_1<10^{-6} **hoáº·c** 50 vÃ²ng (kinh nghiá»‡m cho KB cá»¡ MuSiQue chá»‰ ~20 vÃ²ng lÃ  há»™i tá»¥).
    

---

#### Háº­u quáº£ sau má»—i vÃ²ng

- **Phrase-node â€œÄ‘áº­mâ€**  
    â€“ vÃ¬ Ä‘Æ°á»£c â€œrÃ³t láº¡iâ€ 1âˆ’d1-d = 0.5 má»—i bÆ°á»›c nÃªn luÃ´n giá»¯ sáº¯c tá»‘ cao â†’ Ä‘áº£m báº£o **Ä‘á»‹nh hÆ°á»›ng**.
    
- **Passage-node â€œlá»£tâ€**  
    â€“ ban Ä‘áº§u chá»‰ cÃ³ wâ‹…cosinew\cdot\text{cosine} (â‰ˆ 5 %) nhÆ°ng náº¿u káº¿t cáº¥u Ä‘á»“ thá»‹ dáº«n má»±c liÃªn tá»¥c (phrase â†’ passage) thÃ¬ sáº½ **tÃ­ch má»±c dáº§n** vÃ  leo háº¡ng.
    
- á» vÃ²ng cuá»‘i thu Ä‘Æ°á»£c n\*\mathbf n^\*.
    
    - **Äiá»ƒm passage** = giÃ¡ trá»‹ trÃªn node-passage **+** tá»•ng cÃ¡c phrase-con (_contains_).
        
    - Láº¥y top K (=5) cho reader.
        

---

> _â€œReset probabilities are assigned based on ranking scores for phrase nodes, while passage nodes receive scores proportional to their embedding similarity, **adjusted by a weight factor (Â§ 6.2)** â€¦ We set the damping factor to **0.5** after tuning.â€_ îˆ€citeîˆ‚turn6file13îˆ

NhÆ° váº­y, â€œdÃ²ng má»±câ€ á»Ÿ má»—i bÆ°á»›c luÃ´n phÃ¢n chia **50 % quay vá» seed, 50 % lan truyá»n dá»c cáº¡nh**, khiáº¿n cÃ¡c passage liÃªn quan (dÃ¹ xa 2-3-hop) dáº§n â€œtháº¥m má»±câ€ vÃ  ná»•i lÃªn trong top-k.